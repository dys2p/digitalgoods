{{define "content"}}
<h1>Digital Goods</h1>
<p>{{.Translate "how"}}</p>
<ol>
	<li>{{.Translate "how-1"}}</li>
	<li>{{.Translate "how-2"}}</li>
	<li>
		{{.Translate "how-3"}}
		<ul>
			<li>{{.Translate "how-3a"}}</li>
			<li>{{.Translate "how-3b"}}</li>
			<li>{{.Translate "how-3c"}}</li>
		</ul>
	</li>
	<li>{{.Translate "how-4"}}</li>
	<li>{{.Translate "how-5"}}</li>
</ol>
{{if .OrderErr}}
	<div class="alert alert-danger">{{.Translate "order-error"}}</div>
{{end}}
<form method="post">
	<table class="table">
		<thead>
			<tr>
				<th>{{.Translate "product"}}</th>
				<th></th>
				<th>{{.Translate "amount"}}</th>
				<th>{{.Translate "in-stock"}}</th>
				<th>{{.Translate "item-price"}}</th>
			</tr>
		</thead>
		<tbody>
		{{range .Categories}}
			<tr>
				<td colspan="5">
					<!-- same as in purchase.html -->
					<input style="display: none" type="checkbox" id="toggle-{{.ID}}">
					<label for="toggle-{{.ID}}">
						<strong>{{.Name}}</strong>
						({{$.Translate "click-more"}})
					</label>
					<style>
					#toggle-{{.ID}} ~ div {
						display: none;
					}
					#toggle-{{.ID}}:checked ~ div {
						display: block;
					}
					</style>
					<div class="mt-2 mb-1">
						{{.Translate $.Language}}
					</div>
					<!-- end -->
				</td>
			</tr>
			{{range $.ArticlesByCategory .}}
				{{if .Portfolio}}
					{{$article := .}}
					{{range $.TranslateAndSort ($.FeaturedCountryIDs $article)}}
						<tr>
							<td class="ps-4">{{$article.Name}}</td>
							<td>{{if ne .Name "all"}}{{.Name}}{{end}}</td>
							<td>
								{{$max := $article.Max .ID}}
								{{if gt $max 0}}
									<input name="{{$article.ID}}-{{.ID}}" type="number" min="0" max="{{$max}}" value="{{index $.Cart (printf "%s-%s" $article.ID .ID)}}" class="form-control" style="width: calc(1.75rem + 2px + 5ch); padding-top: 0.1875rem; padding-bottom: 0.1875rem; margin-top: -0.1875rem; margin-bottom: -0.1875rem">
								{{end}}
							</td>
							<td>{{index $article.Stock .ID}}</td>
							<td>{{FmtEuro $article.Price}}</td>
						</tr>
					{{end}}
					{{with $.TranslateAndSort ($.OtherCountryIDs $article)}}
						{{$selectedCountryID := $.Translate "default-iso-country"}}
						{{with index $.OtherCountry $article.ID}}
							{{$selectedCountryID = .}}
						{{end}}
						<tr>
							<td class="ps-4">{{$article.Name}}</td>
							<td>
								<select name="{{$article.ID}}-other-country" class="form-select" style="padding-top: 0.1875rem; padding-bottom: 0.1875rem; margin-top: -0.1875rem; margin-bottom: -0.1875rem">
									<option><!-- if selectedCountryID is among the featured countries --></option>
									{{range .}}
										<option {{if eq $selectedCountryID .ID}}selected{{end}} value="{{.ID}}">{{.Name}}</option>
									{{end}}
								</select>
							</td>
							<td>
								<input name="{{$article.ID}}-other-amount" type="number" min="0" max="100" value="{{index $.Cart (printf "%s-other-amount" $article.ID)}}" class="form-control" style="width: calc(1.75rem + 2px + 5ch); padding-top: 0.1875rem; padding-bottom: 0.1875rem; margin-top: -0.1875rem; margin-bottom: -0.1875rem">
							</td>
							<td>0</td><!-- assuming non-featured items are not on stock -->
							<td>{{FmtEuro $article.Price}}</td>
						</tr>
					{{end}}
				{{end}}
			{{end}}
		{{end}}
		</tbody>
	</table>

	<div class="mb-3">
		<label class="form-label">{{.Translate "country-tax-question"}}</label>
		<select class="form-select {{if .CountryErr}}is-invalid{{end}}" name="country" required>
			<optgroup label="{{.Translate "non-EU"}}">
				<option {{if eq .CountryAnswer "non-EU"}}selected{{end}} value="non-EU">{{.Translate "non-EU"}}</option>
			</optgroup>
			<optgroup label="{{.Translate "EU"}}">
				{{range $.TranslateAndSort $.EUCountryCodes}}
					<option {{if eq $.CountryAnswer .ID}}selected{{end}} value="{{.ID}}">{{.Name}}</option>
				{{end}}
			</optgroup>
		</select>
		<div class="invalid-feedback">{{.Translate "country-error"}}</div>
	</div>

	<p class="text-center">
		<img id="captcha-image" src="/captcha/{{.CaptchaID}}.png" alt="Captcha image">
	</p>
	<div class="mb-3">
		<label for="captcha-answer" class="form-label">{{.Translate "captcha-label"}}</label>
		<input class="form-control {{if .CaptchaErr}}is-invalid{{end}}" id="captcha-answer" name="captcha-answer" value="{{.CaptchaAnswer}}" type="number" required>
		<div class="invalid-feedback">{{.Translate "captcha-error"}}</div>
		<div class="form-text"><a class="text-muted" href="#" onclick="reloadCaptcha(); return false;">{{.Translate "captcha-reload"}}</a></div>
	</div>
	<input type="hidden" name="captcha-id" value="{{.CaptchaID}}">
	<div class="text-end">
		<input class="btn btn-success" type="submit" value="{{.Translate "submit-order"}}">
	</div>
</form>
{{end}}
