{{define "content"}}
<h1>Digital Goods</h1>
<ol>
	<li>{{.Tr "Enter the amount and press „Order“."}}</li>
	<li>{{.Tr "Save the URL of your order. You need it to access your goods if you closed the browser tab."}}</li>
	<li>
		{{.Tr "Pay your order using one of these methods. (Unpaid orders are deleted after 30 days.)"}}
		<ul>
			<li>{{.Tr "Monero (XMR) or Bitcoin (BTC): The fastest method. Your voucher codes are shown as soon as your payment is confirmed on the blockchain."}}</li>
			<li>{{.Tr "Cash: Send an insured letter or package with cash to our office in Germany. We shred the letter after processing."}}</li>
			<li>{{.Tr "SEPA (Single Euro Payments Area) bank transfer to our German bank account. We manually check for new incoming payments every day."}}</li>
		</ul>
	</li>
	<li>{{.Tr "As soon as your payment arrives, your voucher codes are shown. In the unlikely case that your goods have become sold out in the meantime, your codes will appear as soon as they are back in stock."}}</li>
	<li>{{.Tr "Write down your codes. We will delete them 30 days after delivery."}}</li>
</ol>
{{if .OrderErr}}
	<div class="alert alert-danger">{{.Tr "Please select some products."}}</div>
{{end}}
<form method="post">
	<table class="table">
		<thead>
			<tr>
				<th>{{.Tr "Product"}}</th>
				<th></th>
				<th>{{.Tr "Amount"}}</th>
				<th>{{.Tr "In Stock"}}</th>
				<th>{{.Tr "Item Price"}}</th>
			</tr>
		</thead>
		<tbody>
		{{range call .Categories}}
			<tr>
				<td colspan="5">
					<!-- same as in purchase.html -->
					<input style="display: none" type="checkbox" id="toggle-{{.ID}}">
					<label for="toggle-{{.ID}}">
						<strong>{{.Name}}</strong>
						({{$.Tr "click here to read more"}})
					</label>
					<style>
					#toggle-{{.ID}} ~ div {
						display: none;
					}
					#toggle-{{.ID}}:checked ~ div {
						display: block;
					}
					</style>
					<div class="mt-2 mb-1">
						{{.TranslateDescription $.Lang}}
					</div>
					<!-- end -->
				</td>
			</tr>
			{{range (call $.ArticlesByCategory .)}}
				{{if .Portfolio}}
					{{$article := .}}
					{{range $article.FeaturedCountryIDs}}
						<tr>
							<td class="ps-4">{{$article.Name}} {{if $article.OnDemandOnly .}}(on demand){{end}}</td>
							<td>{{if ne . "all"}}{{.}}{{end}}</td>
							<td>
								{{$max := $article.Max .}}
								{{if gt $max 0}}
									<input name="{{$article.ID}}-{{.}}" type="number" min="0" max="{{$max}}" value="{{index $.Cart (printf "%s-%s" $article.ID .)}}" class="form-control" style="width: calc(1.75rem + 2px + 5ch); padding-top: 0.1875rem; padding-bottom: 0.1875rem; margin-top: -0.1875rem; margin-bottom: -0.1875rem">
								{{end}}
							</td>
							<td>{{index $article.Stock .}}</td>
							<td>{{FmtEuro $article.Price}}</td>
						</tr>
					{{end}}
					{{with $article.OtherCountryIDs}}
						{{$selectedCountryID := $.Tr "default-iso-country"}}
						{{with index $.OtherCountry $article.ID}}
							{{$selectedCountryID = .}}
						{{end}}
						<tr>
							<td class="ps-4">{{$article.Name}} {{if $article.OnDemand}}(on demand){{end}}</td><!-- assuming other country IDs are always on demand -->
							<td>
								<select name="{{$article.ID}}-other-country" class="form-select" style="padding-top: 0.1875rem; padding-bottom: 0.1875rem; margin-top: -0.1875rem; margin-bottom: -0.1875rem">
									<option>{{$.Tr "Select other country"}}</option><!-- autoselected if $selectedCountryID is empty -->
									{{range .}}
										<option {{if eq $selectedCountryID .}}selected{{end}} value="{{.}}">{{.}}</option>
									{{end}}
								</select>
							</td>
							<td>
								<input name="{{$article.ID}}-other-amount" type="number" min="0" max="100" value="{{index $.Cart (printf "%s-other-amount" $article.ID)}}" class="form-control" style="width: calc(1.75rem + 2px + 5ch); padding-top: 0.1875rem; padding-bottom: 0.1875rem; margin-top: -0.1875rem; margin-bottom: -0.1875rem">
							</td>
							<td>0</td><!-- assuming non-featured items are not on stock -->
							<td>{{FmtEuro $article.Price}}</td>
						</tr>
					{{end}}
				{{end}}
			{{end}}
		{{end}}
		</tbody>
	</table>

	<div class="mt-4 mb-3">
		<label class="form-label">{{.Tr "Where do you live? (We have to ask that for tax reasons. It does not affect the price or the goods.)"}}</label>
		{{if .AvailableNonEU}}
			<div class="form-check {{if .CountryErr}}is-invalid{{end}}">
				<input class="form-check-input"  id="non-eu" type="radio" name="area" value="non-eu" {{if eq $.Area "non-eu"}}checked{{end}} onclick="document.getElementById('eu-country').disabled = true;">
				<label class="form-check-label" for="non-eu">{{.Tr "Not in the European Union"}}</label>
			</div>
		{{end}}
		{{if .AvailableEUCountries}}
			<div class="d-flex align-items-center">
				<div class="form-check me-2">
					<input class="form-check-input"  id="eu" type="radio" name="area" value="eu" {{if eq $.Area "eu"}}checked{{end}} onclick="document.getElementById('eu-country').disabled = false;">
					<label class="form-check-label" for="eu">{{.Tr "European Union"}}:</label>
				</div>
				<select class="form-select d-inline w-auto" id="eu-country" name="eu-country" onchange="document.getElementById('eu').checked = true;">
					<option class="text-secondary">{{.Tr "please select"}}</option>
					{{range $.AvailableEUCountries}}
						<option {{if eq $.EUCountry .Country}}selected{{end}} value="{{.Country}}">{{.Name}}</option>
					{{end}}
				</select>
			</div>
		{{end}}
		<div class="invalid-feedback">{{.Tr "Please select your country of residence."}}</div>
		<div class="form-text">{{.Tr "Options are limited by your IP address and browser language."}}</div>
	</div>

	{{template "captcha" .Captcha}}

	<div class="text-end">
		<input class="btn btn-success" type="submit" value="{{.Tr "Create order"}}">
	</div>
</form>
{{end}}
