{{define "content"}}
<h1>{{.Translate "purchase"}} {{.Purchase.AccessKey}}</h1>
<div class="alert {{AlertContextualClass .Purchase.Status}}"><strong>{{.Translate "status"}}</strong>: {{.Translate (printf "%s%s" "status-" .Purchase.Status)}}</div>
{{if .Purchase.DeleteDate}}
	<p>{{.Translate "info-delete"}} {{.FmtDate .Purchase.ParseDeleteDate}}</p>
{{end}}
{{with .PaysrvErr}}
	<p class="alert alert-danger">Unser Payserver lieferte eine Fehlermeldung: {{.}}</p>
{{end}}
{{if .Purchase.Waiting}}
	<script>
		scheduleReload();
	</script>
	<noscript>
		<p>{{.Translate "javascript-reload"}}</p>
	</noscript>
{{end}}
<h2>{{.Translate "whats-next"}}</h2>
<ol>
	{{if .Purchase.Unpaid}}
		<li>{{.Translate "next-1"}}</li>
	{{end}}
	<!-- same as in order.html -->
	<li>{{.Translate "how-2"}} <code>{{.URL}}</code></li>
	{{if .Purchase.Unpaid}}
		<li>{{.Translate "how-3"}}</li>
		<li>{{.Translate "how-4"}}</li>
	{{end}}
	<li>{{.Translate "how-5"}}</li>
	<!-- end -->
</ol>
{{if .Purchase.Unpaid}}
	<h2 id="payment">{{.Translate "payment"}}</h2>
	<div>
		<ul class="nav nav-tabs my-3">
			{{range .PaymentMethods}}
				<li class="nav-item">
					<a class="nav-link {{if eq $.ActiveTab .ID}}active{{end}}" href="{{$.URL}}/{{.ID}}#payment">{{.Name $.HTTPRequest}}</a>
				</li>
			{{end}}
		</ul>
		<p>{{.PaymentMethod.PayHTML $.HTTPRequest .Purchase.ID .Purchase.PaymentKey}}</p>
	</div>
{{end}}
<h2>{{.Translate "your-order"}}</h2>
<table class="table">
	<thead>
		<tr>
			<th>{{.Translate "product"}}</th>
			<th>{{.Translate "amount"}}</th>
			<th>{{.Translate "item-price"}}</th>
			<th>{{.Translate "sum"}}</th>
		</tr>
	</thead>
	<tbody>
		{{range (call .GroupedOrder .Purchase.Ordered)}}
			{{if gt (len .Rows) 0}}
			<tr>
				<td colspan="4">
					{{with .Category}}
						<!-- same as in order.html -->
						<input style="display: none" type="checkbox" id="toggle-{{.ID}}">
						<label for="toggle-{{.ID}}">
							<strong>{{.Name}}</strong>
							({{$.Translate "click-more"}})
						</label>
						<style>
						#toggle-{{.ID}} ~ div {
							display: none;
						}
						#toggle-{{.ID}}:checked ~ div {
							display: block;
						}
						</style>
						<div class="mt-2 mb-1">
							{{$.TranslateCategoryDescription .}}
						</div>
						<!-- end -->
					{{end}}
				</td>
			</tr>
				{{range .Rows}}
				<tr>
					<td>{{.Article.Name}} {{with .CountryID}}{{if ne . "all"}}({{$.Translate .}}){{end}}{{end}}</td>
					<td>{{.Amount}}</td>
					<td>{{FmtEuro .ItemPrice}}</td>
					<td>{{FmtEuro .Sum}}</td>
				</tr>
				{{end}}
			{{end}}
		{{end}}
		<tr>
			<td colspan="3">{{.Translate "overall-sum"}}</td>
			<td>{{FmtEuro .Purchase.Ordered.Sum}}</td>
		</tr>
	</tbody>
</table>
<h2>{{.Translate "your-goods"}}</h2>
<table class="table">
	<thead>
		<tr>
			<th>{{.Translate "product"}}</th>
			<th>{{.Translate "delivery-date"}}</th>
			<th>{{.Translate "code"}}</th>
		</tr>
	</thead>
	<tbody>
		{{range .Purchase.Delivered}}
		<tr>
			<td>{{.ArticleID}} {{with .CountryID}}{{if ne . "all"}}({{$.Translate .}}){{end}}{{end}}</td>
			<td>{{$.FmtDate .ParseDeliveryDate}}</td>
			<td>
				{{if .Image}}
					<!-- use image as code -->
					<img src="{{.ImageSrc}}" />
				{{else}}
					<!-- use ID as code -->
					{{if IsURL .ID}}
						<a rel="noreferrer" target="_blank" href="{{.ID}}">{{.ID}}</a>
					{{else}}
						{{.ID}}
					{{end}}
				{{end}}
			</td>
		</tr>
		{{end}}
		{{if .Purchase.Underdelivered}}
		<tr>
			<td colspan="3">{{.Translate "sorry-underdelivered"}}</td>
		</tr>
		{{end}}
		{{if .Purchase.Unpaid}}
		<tr>
			<td colspan="3">{{.Translate "info-unpaid"}}</td>
		</tr>
		{{end}}
	</tbody>
</table>
{{end}}
